class IDOCS_Live_Search{constructor(){if(this.closeButton=jQuery(".idocs-live-search-close-search-button"),this.searchOverlay=jQuery(".idocs-live-search-result"),this.ResultHeight=this.searchOverlay.css("height"),this.searchField=jQuery("#idocs-search-term"),0==this.searchField.length)return;this.kb_id=this.searchField.data("kb_id"),this.selected_category=jQuery("#idocs-selected-category"),this.internalUser=jQuery("#idocs-internal-user"),this.userID=jQuery("#idocs-user-id"),this.currentIP=jQuery("#idocs-current-ip"),this.analyticsVideoVisitEvent=jQuery("#idocs-analytics-video-visit-event").val(),this.typingTimer,this.resultDiv=this.searchOverlay,this.previousValue,this.configuredTimer,this.searchThreshold,this.searchOrderAlphabetically,this.noResultFeedback,this.handleArrowKeysBound,this.handleEnterKeyBound,this.handleEscKeyBound,this.player,this.handleVideoEscKeyBound,this.closeVideoHandler,this.VideoWasClosed=!1,this.getSearchSettings(),this.registerEvents()}registerEvents(){this.closeButton.on("click",this.closeOverlay.bind(this)),this.searchField.on("keyup",this.typingLogic.bind(this))}getSearchSettings(){var e=this;jQuery.ajax({type:"GET",dataType:"json",url:idocs_ajax_obj.root_url+"/wp-json/incredibledocs/v1/search_parameters",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",idocs_ajax_obj.nonce)},data:{kb_id:e.kb_id}}).done(function(s){e.configuredTimer=parseInt(s.keystroke_delay_before_search),e.searchThreshold=parseInt(s.min_amount_characters_for_search),e.searchOrderAlphabetically=parseInt(s.search_order_alphabetically),e.noResultFeedback=s.no_result_feedback})}typingLogic(){this.searchField.val()!=this.previousValue&&(clearTimeout(this.typingTimer),this.searchField.val()?this.typingTimer=setTimeout(this.getResults.bind(this),this.configuredTimer):(this.resultDiv.html(""),this.searchOverlay.addClass("d-none"),this.closeButton.addClass("d-none"))),this.previousValue=this.searchField.val()}getResults(){var e="";let s=this;e=this.searchOrderAlphabetically?"title":"date",this.searchField.val().length>=this.searchThreshold&&jQuery.ajax({type:"GET",dataType:"json",url:idocs_ajax_obj.root_url+"/wp-json/incredibledocs/v1/search",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",idocs_ajax_obj.nonce)},data:{keyword:this.searchField.val(),order_by:e,kb_id:this.kb_id,cat_id:this.selected_category.val(),internal_user:this.internalUser.val(),user_id:this.userID.val(),pro:0}}).done(function(e){var t;s.searchOverlay.removeClass("d-none"),s.closeButton.removeClass("d-none"),0==e.content.length?(s.searchOverlay.css("height","70px"),s.resultDiv.html(`
							<p style="text-align: center; margin: auto; padding:10px">
								${s.noResultFeedback}
							</p>
							`)):(s.searchOverlay.css("height",s.ResultHeight),s.resultDiv.html(`
							
							<ul id="idocs-result-list">								
								 ${e.content.map((s,t)=>`<a href="${s.permalink}" title = "Result Item Link">
													<li class="idocs-live-search-result-item" tabindex="${t+1}" data-content_type="${s.content_type}" data-video_id="${s.video_id}" data-video_type="${s.video_type}" data-video_link="${s.video_link}" data-content_id="${s.content_id}">

                                                        ${e.icons[s.content_type]}
                                                        <span class="idocs-live-search-result-item-title">${s.title}</span>
														<span class="idocs-live-search-result-item-category">${s.category}</span>
                                                    </li>
                                                </a>`).join("")}
							</ul>`),s.resultDiv.find('.idocs-live-search-result-item[tabindex="1"]').addClass("idocs-live-search-result-item-active"),s.handleArrowKeysBound=s.handleArrowKeys.bind(s),s.handleEnterKeyBound=s.handleEnterKey.bind(s),s.handleEscKeyBound=s.handleEscKey.bind(s),document.addEventListener("keydown",s.handleArrowKeysBound),document.addEventListener("keydown",s.handleEnterKeyBound),document.addEventListener("keyup",s.handleEscKeyBound)),t=e.content.length>0?1:0,s.saveSearchEvent(idocs_ajax_obj,s.searchField.val(),t,s.currentIP.val(),s.kb_id)})}saveSearchEvent(e,s,t,i,a){jQuery.ajax({type:"GET",dataType:"json",url:e.root_url+"/wp-json/incredibledocs/v1/save_search",beforeSend:function(s){s.setRequestHeader("X-WP-Nonce",e.nonce)},data:{keyword:s,found_flag:t,current_ip:i,kb_id:a}}).done(function(e){})}openOverlay(){this.closeButton.removeClass("d-none"),this.searchOverlay.removeClass("d-none"),this.searchField.val(""),this.resultDiv.html(""),this.searchField.focus()}closeOverlay(){this.searchOverlay.addClass("d-none"),this.closeButton.addClass("d-none"),this.searchField.val(""),this.previousValue="",this.resultDiv.html(""),document.removeEventListener("keydown",this.handleArrowKeysBound),document.removeEventListener("keydown",this.handleEnterKeyBound),document.removeEventListener("keyup",this.handleEscKeyBound)}handleEscKey(e){let s=e.key;"Escape"==s&&(this.VideoWasClosed?this.VideoWasClosed=!1:this.closeOverlay())}handleArrowKeys(e){let s=e.key;if("ArrowUp"===s||"ArrowDown"===s){e.preventDefault();let t=this.resultDiv.find(".idocs-live-search-result-item"),i=t.index(t.filter(".idocs-live-search-result-item-active")),a;a="ArrowUp"===s?i>0?i-1:t.length-1:i<t.length-1?i+1:0,t.removeClass("idocs-live-search-result-item-active"),t.eq(a).addClass("idocs-live-search-result-item-active")}}handleEnterKey(e){let s=e.key;if("Enter"===s){let t=this.resultDiv.find(".idocs-live-search-result-item-active"),i=t.closest("a").attr("href");i&&(window.location.href=i)}}}const instance_Live_Search=new IDOCS_Live_Search;